<!DOCTYPE html>
<html lang="zh-cn">

<head>

  
  <meta charset="UTF-8">
  <title>
    HTML5整理总结 | wuxingtao Blog
  </title>


  
  <meta name="viewport" content="width=device-width,user-scalable=no,maximum-scale=1,initial-scale=1">

  
  <link rel="canonical" href="https://www.wuxingtao.club/posts/summary-html5-learn/" />

  
  
  
  
  <link rel="stylesheet" href="https://fonts.loli.net/icon?family=Material+Icons">
  <link href="//cdn.bootcss.com/highlight.js/9.12.0/styles/ocean.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://www.wuxingtao.club/css/index.css">
  
  <link rel="stylesheet" href="https://www.wuxingtao.club/css/custom.css">
  
  <link href="https://www.wuxingtao.club/index.xml" rel="alternate" type="application/rss+xml" title="wuxingtao Blog" />
  <link href="https://www.wuxingtao.club/index.xml" rel="feed" type="application/rss+xml" title="wuxingtao Blog" />

  
  <link href="https://www.wuxingtao.club/favicon.ico" rel="shortcut icon">

  <script>
    window.baseURL = 'https:\/\/www.wuxingtao.club';
  </script>
</head>







<body>
  <div class="navbar-fixed">
    <nav class="navbar">
      <div class="nav-container container">
        <div class="nav-wrapper inner">
          <a href="javascript:void(0)" data-activates="sidebar" class="button-collapse hide-on-large-only">
            <i class="material-icons">menu</i>
          </a>
          <a href="https://www.wuxingtao.club" class="brand-logo">
            <i class="material-icons hide-on-med-and-down">restaurant_menu</i>
            wuxingtao Blog
          </a>
          
          <ul class=" nav-menu tabs tabs-transparent hide-on-med-and-down">
            
            <li class="tab">
              <a href="https://www.wuxingtao.club/" class=''>
                Home
              </a>
            </li>
            
            <li class="tab">
              <a href="https://www.wuxingtao.club/archive/" class=''>
                Archive
              </a>
            </li>
            
            <li class="tab">
              <a href="https://www.wuxingtao.club/about/" class=''>
                About
              </a>
            </li>
            
            <li class="tab">
              <a href="https://www.wuxingtao.club/description/" class=''>
                简历
              </a>
            </li>
            
          </ul>
          

          <form class="nav-form hide-on-small-and-down">
            <div class="form-group">
              <i class="material-icons">search</i>
              <input type='text' placeholder="输入搜索关键字" />
            </div>
            <div class="form-popout">
              <div class="search-result">
                <label>暂无搜索结果</label>
                <ul>
                </ul>
              </div>
            </div>
          </form>


          <ul class=" nav-menu apps">
            
            <li>
              <a class="search-btn hide-on-med-and-up" href='#search-panel'>
                <i class="material-icons">search</i>
              </a>
            </li>
            <li>
              <a class="term-btn hide-on-small-and-down" href='#term-panel'>
                <i class="material-icons">apps</i>
              </a>
            </li>
            <li>
              <a class="rss-btn hide-on-small-and-down" href='https://www.wuxingtao.club/index.xml' target="_blank">
                <i class="material-icons">rss_feed</i>
              </a>
            </li>
          </ul>
        </div>
      </div>
    </nav>
  </div>

  
  <div class="mobile-search hide-on-med-and-up">
  <div class="header">
    
    <i class="material-icons">search</i>
    <input type='text' placeholder="输入搜索关键字" />
    <i class="material-icons mobile-search-close">cancel</i>
  </div>
  <div class="content">
    <label>暂无搜索结果</label>
    <ul></ul>
  </div>
</div>
  

  <div class="taxonomy">
    <div class="container">
      <div class="inner">
        <div class="taxonomy-panel">
          
          <div class='group'>
            <label>Category</label>
            <ul>
                
              <li>
                <a class="btn btn-secondary" href='https://www.wuxingtao.club/categories/summary'> summary
                  <span class="badge">10</span>
                </a>
              </li>
              
              <li>
                <a class="btn btn-secondary" href='https://www.wuxingtao.club/categories/node'> node
                  <span class="badge">2</span>
                </a>
              </li>
              
              <li>
                <a class="btn btn-secondary" href='https://www.wuxingtao.club/categories/tao'> tao
                  <span class="badge">1</span>
                </a>
              </li>
              
            </ul>
          </div>
          
          <div class='group'>
            <label>Tag</label>
            <ul>
                
              <li>
                <a class="btn btn-secondary" href='https://www.wuxingtao.club/tags/summary'> summary
                  <span class="badge">5</span>
                </a>
              </li>
              
              <li>
                <a class="btn btn-secondary" href='https://www.wuxingtao.club/tags/javascript'> javascript
                  <span class="badge">3</span>
                </a>
              </li>
              
              <li>
                <a class="btn btn-secondary" href='https://www.wuxingtao.club/tags/node'> node
                  <span class="badge">2</span>
                </a>
              </li>
              
              <li>
                <a class="btn btn-secondary" href='https://www.wuxingtao.club/tags/ajax'> ajax
                  <span class="badge">1</span>
                </a>
              </li>
              
              <li>
                <a class="btn btn-secondary" href='https://www.wuxingtao.club/tags/development'> development
                  <span class="badge">1</span>
                </a>
              </li>
              
              <li>
                <a class="btn btn-secondary" href='https://www.wuxingtao.club/tags/express'> express
                  <span class="badge">1</span>
                </a>
              </li>
              
              <li>
                <a class="btn btn-secondary" href='https://www.wuxingtao.club/tags/git'> git
                  <span class="badge">1</span>
                </a>
              </li>
              
              <li>
                <a class="btn btn-secondary" href='https://www.wuxingtao.club/tags/go'> go
                  <span class="badge">1</span>
                </a>
              </li>
              
              <li>
                <a class="btn btn-secondary" href='https://www.wuxingtao.club/tags/golang'> golang
                  <span class="badge">1</span>
                </a>
              </li>
              
              <li>
                <a class="btn btn-secondary" href='https://www.wuxingtao.club/tags/hack'> hack
                  <span class="badge">1</span>
                </a>
              </li>
              
              <li>
                <a class="btn btn-secondary" href='https://www.wuxingtao.club/tags/html'> html
                  <span class="badge">1</span>
                </a>
              </li>
              
              <li>
                <a class="btn btn-secondary" href='https://www.wuxingtao.club/tags/hugo'> hugo
                  <span class="badge">1</span>
                </a>
              </li>
              
              <li>
                <a class="btn btn-secondary" href='https://www.wuxingtao.club/tags/mongodb'> mongodb
                  <span class="badge">1</span>
                </a>
              </li>
              
              <li>
                <a class="btn btn-secondary" href='https://www.wuxingtao.club/tags/react'> react
                  <span class="badge">1</span>
                </a>
              </li>
              
              <li>
                <a class="btn btn-secondary" href='https://www.wuxingtao.club/tags/regexp'> regexp
                  <span class="badge">1</span>
                </a>
              </li>
              
              <li>
                <a class="btn btn-secondary" href='https://www.wuxingtao.club/tags/seajs'> seajs
                  <span class="badge">1</span>
                </a>
              </li>
              
              <li>
                <a class="btn btn-secondary" href='https://www.wuxingtao.club/tags/templates'> templates
                  <span class="badge">1</span>
                </a>
              </li>
              
              <li>
                <a class="btn btn-secondary" href='https://www.wuxingtao.club/tags/theme'> theme
                  <span class="badge">1</span>
                </a>
              </li>
              
              <li>
                <a class="btn btn-secondary" href='https://www.wuxingtao.club/tags/themes'> themes
                  <span class="badge">1</span>
                </a>
              </li>
              
              <li>
                <a class="btn btn-secondary" href='https://www.wuxingtao.club/tags/vscode'> vscode
                  <span class="badge">1</span>
                </a>
              </li>
              
              <li>
                <a class="btn btn-secondary" href='https://www.wuxingtao.club/tags/webstorm'> webstorm
                  <span class="badge">1</span>
                </a>
              </li>
              
            </ul>
          </div>
           
        </div>
      </div>
    </div>
  </div>

  
  <ul class="side-nav" id="sidebar">
    
    <li>
      <a href="https://www.wuxingtao.club/" class=''>
        Home
      </a>
    </li>
    
    <li>
      <a href="https://www.wuxingtao.club/archive/" class=''>
        Archive
      </a>
    </li>
    
    <li>
      <a href="https://www.wuxingtao.club/about/" class=''>
        About
      </a>
    </li>
    
    <li>
      <a href="https://www.wuxingtao.club/description/" class=''>
        简历
      </a>
    </li>
    
    <li>
      <a class="term-btn-mobile hide-on-med-only" href='https://www.wuxingtao.club/categories/'>
        Categories
      </a>
    </li>
    <li>
      <a class="term-btn-mobile hide-on-med-only" href='https://www.wuxingtao.club/tags/'>
        Tags
      </a>
    </li>
    <li>
      <a class="rss-btn-mobile hide-on-med-only" href='https://www.wuxingtao.club/index.xml' target="_blank">
        Rss
      </a>
    </li>
  </ul>
  





<main id="single" role="main" class="main-panel">
  <div class="page-content">
    <div class="container container-ex">
      <div class="inner">
        <section class="post-wrapper">
          
          <div class="toc-panel">
            <nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#html5中类jquery选择器queryselector的使用">HTML5中类jQuery选择器querySelector的使用</a>
<ul>
<li><a href="#ie6-ie7兼容queryselectorall和queryselector方法-最终版本">IE6、IE7兼容querySelectorAll和querySelector方法-最终版本</a></li>
</ul></li>
<li><a href="#css3动画那么强-requestanimationframe还有毛线用">CSS3动画那么强，requestAnimationFrame还有毛线用？</a></li>
<li><a href="#html5-deviceorientation-方向接口应用">HTML5 DeviceOrientation 方向接口应用</a>
<ul>
<li><a href="#1-摇一摇">1. 摇一摇</a>
<ul>
<li><a href="#实现方法">实现方法</a></li>
</ul></li>
<li><a href="#2-重力感应">2. 重力感应</a>
<ul>
<li><a href="#接口说明">接口说明</a></li>
<li><a href="#工作原理">工作原理</a></li>
<li><a href="#实现方式和示例">实现方式和示例</a></li>
<li><a href="#扩展应用">扩展应用</a></li>
</ul></li>
<li><a href="#使用phaser和html5特性检测移动设备旋转重力方向">使用Phaser和HTML5特性检测移动设备旋转重力方向</a></li>
</ul></li>
<li><a href="#html5-orientation-方向接口应用">HTML5 orientation 方向接口应用</a></li>
<li><a href="#html5-地理定位-geolocation">HTML5 - 地理定位 Geolocation</a>
<ul>
<li><a href="#完美解决window-navigator-geolocation-getcurrentposition-在ios10系统中无法定位问题">完美解决window.navigator.geolocation.getCurrentPosition，在IOS10系统中无法定位问题</a></li>
</ul></li>
<li><a href="#html5的popstate如何玩转浏览器历史记录">HTML5的popstate如何玩转浏览器历史记录</a></li>
<li><a href="#html5-workers-后台运行js">Html5 workers 后台运行js</a></li>
<li><a href="#前端项目优化">前端项目优化</a>
<ul>
<li><a href="#一页面级优化">一页面级优化</a></li>
<li><a href="#二-代码级优化">二、代码级优化</a></li>
<li><a href="#dom结构-timeline-repaint-重绘-与reflow-回流">DOM结构 timeline repaint(重绘)与reflow(回流)</a></li>
</ul></li>
</ul></li>
</ul>
</nav>
          </div>
          
          <div class="post reveal ">
            <div class="card">
              <section class="breadcrumb-root">
  <div class="breadcrumbs" role="navigation" aria-label="breadcrumbs navigation">
     

    <a class="breadcrumb" href="https://www.wuxingtao.club">
      <i class="material-icons">location_on</i>Home</a>
      
    
        
    
      
    
        
    
      
    <span class="breadcrumb">HTML5整理总结</span>

        
    
      
  </div>
</section>
              
              <div class="card-header postinfo">
                <span class="card-title">HTML5整理总结 </span>
              </div>
              <div class="card-header date">
                
                <div class="group">
                  <i class="material-icons">book</i>
                  <address>
                    归档：
                    <a href="https://www.wuxingtao.club/categories/summary">Summary</a>&nbsp; 
                  </address>
                </div>
                
                <div class="group">
                  <i class="material-icons">flag</i>
                  <time>创建：2016年04月 8日
                  </time>
                </div>
                
                

              </div>
              
              <div class="card-content">

                <article class="article">
                  

<p>[toc]</p>

<h2 id="html5中类jquery选择器queryselector的使用">HTML5中类jQuery选择器querySelector的使用</h2>

<p><strong>简介</strong></p>

<p>HTML5向Web API新引入了document.querySelector以及document.querySelectorAll两个方法用来更方便地从DOM选取元素，功能类似于jQuery的选择器。这使得在编写原生JavaScript代码时方便了许多。</p>

<p><strong>用法</strong></p>

<p>两个方法使用差不多的语法，都是接收一个字符串参数，这个参数需要是合法的CSS选择语法。</p>

<pre><code>element = document.querySelector('selectors');
elementList = document.querySelectorAll('selectors');
</code></pre>

<p>其中参数selectors 可以包含多个CSS选择器，用逗号隔开。</p>

<pre><code>element = document.querySelector('selector1,selector2,...');
elementList = document.querySelectorAll('selector1,selector2,...');
</code></pre>

<p>使用这两个方法无法查找带伪类状态的元素，比如querySelector(&rsquo;:hover&rsquo;)不会得到预期结果。</p>

<ul>
<li>querySelector和querySelectorAll IE8+浏览器支持。</li>
<li>querySelector返回的是单个DOM元素；querySelectorAll返回的是NodeList.</li>
<li>我们一般用的多的是document.querySelectorAll, 实际上，也支持dom.querySelectorAll.例如：
<code>document.querySelector(&quot;#my-id&quot;).querySelectorAll(&quot;img&quot;)</code>
选择的就是里面这个妹子。例如，我在控制台输出该选择NodeList的长度和id，如下截图：</li>
</ul>

<pre><code>//test
&lt;img id=&quot;outside&quot;&gt;
&lt;div id=&quot;my-id&quot;&gt;
    &lt;img id=&quot;inside&quot;&gt;
    &lt;div class=&quot;lonely&quot;&gt;&lt;/div&gt;
    &lt;div class=&quot;outer&quot;&gt;
        &lt;div class=&quot;inner&quot;&gt;&lt;/div&gt;
    &lt;/div&gt;
&lt;/div&gt;

document.querySelectorAll(&quot;#my-id div div&quot;).length === 1;
document.querySelector(&quot;#my-id&quot;).querySelectorAll(&quot;div div&quot;).length === 3;
</code></pre>

<p>这里的querySelectorAll里面的选择器也同样是这也全局特性。document.querySelector(&ldquo;#my-id&rdquo;).querySelectorAll(&ldquo;div div&rdquo;)翻译成白话文就是：查询#my-id的子元素，同时满足整个页面下div div选择器条件的DOM元素们。</p>

<p>我们页面往上滚动看看原始的HTML结构，会发现，在全局视野下，<span style="color:red">div.lonely, div.outer, div.inner全部都满足div div这个选择器条件</span>，于是，最终返回的长度为3.</p>

<p><strong>:scope与区域选择限制</strong>
其实，要想querySelectorAll后面选择器不受全局影响，也是有办法的，就是使用目前还处于实验阶段的:scope伪类，其作用就是让CSS是在某一范围内使用。此伪类在CSS中使用是大头，但是也可以在querySelectorAll语句中使用：</p>

<p><code>document.querySelector(&quot;#my-id&quot;).querySelectorAll(&quot;:scope div div&quot;);</code></p>

<p><strong>querySelector</strong></p>

<p>该方法返回满足条件的单个元素。按照深度优先和先序遍历的原则使用参数提供的CSS选择器在DOM进行查找，返回第一个满足条件的元素。</p>

<pre><code>element = document.querySelector('div#container');//返回id为container的首个div
element = document.querySelector('.foo,.bar');//返回带有foo或者bar样式类的首个元素
</code></pre>

<p><strong>querySelectorAll</strong></p>

<p>该方法返回所有满足条件的元素，结果是个nodeList集合。查找规则与前面所述一样。</p>

<p>elements = document.querySelectorAll(&lsquo;div.foo&rsquo;);//返回所有带foo类样式的div
但需要注意的是返回的nodeList集合中的元素是非实时（no-live）的，想要区别什么是实时非实时的返回结果，请看下例：</p>

<pre><code>&lt;div id=&quot;container&quot;&gt;
    &lt;div&gt;&lt;/div&gt;
    &lt;div&gt;&lt;/div&gt;
&lt;/div&gt;
</code></pre>

<pre><code>//首先选取页面中id为container的元素
container=document.getElementById('#container');
console.log(container.childNodes.length)//结果为2
//然后通过代码为其添加一个子元素
container.appendChild(document.createElement('div'));
//这个元素不但添加到页面了，这里的变量container也自动更新了
console.log(container.childNodes.length)//结果为3
</code></pre>

<p>通过上面的例子就很好地理解了什么是会实时更新的元素。document.getElementById返回的便是实时结果，上面对其添加一个子元素后，再次获取所有子元素个数，已经由原来的2个更新为3个(这里不考虑有些浏览器比如Chrome会把空白也解析为一个子节点)。</p>

<p><strong>关于转义</strong></p>

<p>我们知道反斜杠是用来转义用的，比如在字符串里我们想表示空字符就使用&rsquo;\b&rsquo;，换行&rsquo;\n&rsquo;。同样，在提供给querySelector和querySelectorAll的参数也支持转义，了解这点非常重要。</p>

<p>先看个例子，比如我们有个div它的样式类为&rsquo;foo:bar&rsquo;，当然我知道你一般不会这样写。当我们需要选择它的时候，就需要将其中的冒号进行转义，否则抛错。</p>

<p><code>&lt;div class=&quot;foo:bar&quot;&gt;&lt;/div&gt;</code></p>

<p>浏览器报怨表示不是一个合法的选择语句。</p>

<p>同时，有趣的事情来了，或许你以为将冒号直接转义就解决问题了。</p>

<p>同样，也表示非法。原因就在于反斜杠在字符串中本身就表示转义的意思，它于冒号结合转不出东西来，于是抛错。</p>

<p>所以正确的做法是将反斜杠转义后&rsquo;.foo\:bar&rsquo;再传递给querySelector，后者在接收到&rsquo;.foo\:bar&rsquo;这个参数后，字符串将两个反斜杠转义成一个，然后querySelector前面得到的一个反斜杠与冒号结合进行转义得到正确结果。</p>

<p>也就是说经历两次转义，一次是字符串当中，一次是querySelector解析参数时。</p>

<p>理解这点后，可以来看一个更有趣的例子了。比如我们要选择类名里面含反斜杠的元素。是的，我们需要一共使用四个反斜杠！才能正常工作。</p>

<p><code>&lt;div class=&quot;foo\bar&quot;&gt;&lt;/div&gt;</code></p>

<p><strong>浏览器兼容性</strong></p>

<p>目前各主流浏览器对此API提供了良好支持，IE需8+。详情见caniuse。</p>

<p><strong>REFERENCE</strong></p>

<blockquote>
<p>本文主要参考了MDN上的文档
document.querySelectorAll
document.querySelector
NodeList
Feel free to repost but keep the link to this page please!</p>
</blockquote>

<h3 id="ie6-ie7兼容queryselectorall和queryselector方法-最终版本">IE6、IE7兼容querySelectorAll和querySelector方法-最终版本</h3>

<p><strong>　querySelector 和 querySelectorAll 方法是 W3C Selectors API 规范中定义的。他们的作用是根据 CSS 选择器规范，便捷定位文档中指定元素。
目前几乎主流浏览器均支持了他们。包括 IE8(含) 以上版本、 Firefox、 Chrome、Safari、Opera。</strong></p>

<p>　querySelector 和 querySelectorAll 方法很好用，可惜IE6、IE7不支持，怎么让IE6、IE7也支持querySelectorAll和querySelector这两个方法呢，请看下面的代码：</p>

<pre><code>if (!document.querySelectorAll) {
    document.querySelectorAll = function (selectors) {
        var style = document.createElement('style'), elements = [], element;
        document.documentElement.firstChild.appendChild(style);
        document._qsa = [];
 
        style.styleSheet.cssText = selectors + '{x-qsa:expression(document._qsa &amp;&amp; document._qsa.push(this))}';
        window.scrollBy(0, 0);
        style.parentNode.removeChild(style);
 
        while (document._qsa.length) {
            element = document._qsa.shift();
            element.style.removeAttribute('x-qsa');
            elements.push(element);
        }
        document._qsa = null;
        return elements;
    };
}
 
if (!document.querySelector) {
    document.querySelector = function (selectors) {
        var elements = document.querySelectorAll(selectors);
        return (elements.length) ? elements[0] : null;
    };
}
 
// 用于在IE6和IE7浏览器中，支持Element.querySelectorAll方法
var qsaWorker = (function () {
    var idAllocator = 10000;
 
    function qsaWorkerShim(element, selector) {
        var needsID = element.id === &quot;&quot;;
        if (needsID) {
            ++idAllocator;
            element.id = &quot;__qsa&quot; + idAllocator;
        }
        try {
            return document.querySelectorAll(&quot;#&quot; + element.id + &quot; &quot; + selector);
        }
        finally {
            if (needsID) {
                element.id = &quot;&quot;;
            }
        }
    }
 
    function qsaWorkerWrap(element, selector) {
        return element.querySelectorAll(selector);
    }
 
    // Return the one this browser wants to use
    return document.createElement('div').querySelectorAll ? qsaWorkerWrap : qsaWorkerShim;
})();
</code></pre>

<h2 id="css3动画那么强-requestanimationframe还有毛线用">CSS3动画那么强，requestAnimationFrame还有毛线用？</h2>

<p>而我requestAnimationFrame就是为了这个而出现的。我所做的事情很简单，跟着浏览器的绘制走，如果浏览设备绘制间隔是16.7ms，那我就这个间隔绘制；如果浏览设备绘制间隔是10ms, 我就10ms绘制。这样就不会存在过度绘制的问题，动画不会掉帧，自然流畅的说~~</p>

<blockquote>
<p>简单兼容</p>

<pre><code>window.requestAnimFrame = (function(){
  return  window.requestAnimationFrame       ||
          window.webkitRequestAnimationFrame ||
          window.mozRequestAnimationFrame    ||
          function( callback ){
            window.setTimeout(callback, 1000 / 60);
          };
})();
</code></pre>

<p>但是呢，并不是所有设备的绘制时间间隔是1000/60 ms, 以及上面并木有cancel相关方法，所以，就有下面这份更全面的兼容方法：
然后，我们就可以以使用setTimeout的调调使用requestAnimationFrame方法啦，IE6也能支持哦！</p>

<pre><code>(function() {
    var lastTime = 0;
    var vendors = ['webkit', 'moz'];
    for(var x = 0; x &lt; vendors.length &amp;&amp; !window.requestAnimationFrame; ++x) {
        window.requestAnimationFrame = window[vendors[x] + 'RequestAnimationFrame'];
        window.cancelAnimationFrame = window[vendors[x] + 'CancelAnimationFrame'] ||    // Webkit中此取消方法的名字变了
                                      window[vendors[x] + 'CancelRequestAnimationFrame'];
    }
 
    if (!window.requestAnimationFrame) {
        window.requestAnimationFrame = function(callback, element) {
            var currTime = new Date().getTime();
            var timeToCall = Math.max(0, 16.7 - (currTime - lastTime));
            var id = window.setTimeout(function() {
                callback(currTime + timeToCall);
            }, timeToCall);
            lastTime = currTime + timeToCall;
            return id;
        };
    }
    if (!window.cancelAnimationFrame) {
        window.cancelAnimationFrame = function(id) {
            clearTimeout(id);
        };
    }
}());

</code></pre>
</blockquote>

<p>就知道你们这些基佬中看不中用。先给大家普及下缓动(Tween)知识吧：</p>

<p>Linear：无缓动效果
Quadratic：二次方的缓动（t^2）
Cubic：三次方的缓动（t^3）
Quartic：四次方的缓动（t^4）
Quintic：五次方的缓动（t^5）
Sinusoidal：正弦曲线的缓动（sin(t)）
Exponential：指数曲线的缓动（2^t）
Circular：圆形曲线的缓动（sqrt(1-t^2)）
Elastic：指数衰减的正弦曲线缓动
超过范围的三次方缓动（(s+1)*t^3 – s*t^2）
指数衰减的反弹缓动
每个效果都分三个缓动方式，分别是（可采用后面的邪恶记忆法帮助记忆）：</p>

<p>easeIn：从0开始加速的缓动，想象OOXX进去，探路要花时间，因此肯定是先慢后快的；
easeOut：减速到0的缓动，想象OOXX出来，肯定定先快后慢的，以防掉出来；
easeInOut：前半段从0开始加速，后半段减速到0的缓动，想象OOXX进进出出，先慢后快然后再慢。
每周动画效果都有其自身的算法。我们都知道jQuery UI中就有缓动，As脚本也内置了缓动，其中的运动算法都是一致的。我特意弄了一份，哦呵呵呵~~（因为较高，滚动显示），或GitHub访问：</p>

<p><code>tween.js</code>
借助requestAnimationFrame以及上面的动画算法,丰富动画效果</p>

<pre><code>//demo 铁球落下的效果。
funFall = function() {
    var start = 0, during = 100;
    var _run = function() {
         start++;
         var top = Tween.Bounce.easeOut(start, objBall.top, 500 - objBall.top, during);
         ball.css(&quot;top&quot;, top);
         shadowWithBall(top);    // 投影跟随小球的动
         if (start &lt; during) requestAnimationFrame(_run);
    };
    _run();
};
</code></pre>

<h2 id="html5-deviceorientation-方向接口应用">HTML5 DeviceOrientation 方向接口应用</h2>

<p>本文档旨在通过介绍HTML5 DeviceOrientation 和DeviceMotion两个接口的使用，来实现某些场景应用，如</p>

<p>摇一摇功能（DeviceMotion）
重力感应方向控制（DeviceOrientation）
关于DeviceOrientation和DeviceMotion两个接口的详细说明，参考了:<a href="http://w3c.github.io/deviceorientation/spec-source-orientation.html">http://w3c.github.io/deviceorientation/spec-source-orientation.html</a>
本文的中实现的用例仅用来测试，在生产环境中应用需要修改其中的参数或者重新编程。</p>

<h3 id="1-摇一摇">1. 摇一摇</h3>

<p>摇一摇功能是很多原生APP都可以实现的功能，如微信中的摇一摇找好友，QQ音乐中的摇一摇换歌等。它们都是利用了手机加速传感器提供的API，当监听到手机加速变化的事件时，根据获取的加速值来执行不同的动作。</p>

<blockquote>
<p>接口说明
在Web APP中HTML5 也提供了类似的接口，就是DeviceMotionEvent。DeviceMotion封装了运动传感器数据的事件，可以获取手机运动状态下的运动加速度等数据。</p>

<p>DeviceMotionEvent对象属性列表：</p>
</blockquote>

<table>
<thead>
<tr>
<th>属性</th>
<th align="center">释义</th>
</tr>
</thead>

<tbody>
<tr>
<td>event.accelaration</td>
<td align="center">x(y,z):设备在x(y,z)方向上的移动加速度值</td>
</tr>

<tr>
<td>event.accelarationIncludingGravity</td>
<td align="center">x(y,z):考虑了重力加速度后设备在x(y,z)方向上的移动加速度值</td>
</tr>

<tr>
<td>event.rotationRate</td>
<td align="center">alpha,beta,gamma:设备绕x,y,z轴旋转的角度</td>
</tr>
</tbody>
</table>

<p>event.accelarationIncludingGravity与event.accelaration的区别在于前者加入了重力加速度，即在z轴方向加了9.8，在x,y方向上的值两者相同。</p>

<p>旋转速度rotationRate：alpha、beta、gamma的概念与DeviceOrientationEvent一致。</p>

<blockquote>
<p>区别在于：
DeviceOrientationEvent 的值是相对于初始状态的差值，只要设备方向不变，怎么动都不会影响数值；
DeviceMotionEvent 是相对于之前的某个瞬间值的差值时间比，即变化的速度，一旦设备静止则会恢复为0。</p>
</blockquote>

<h4 id="实现方法">实现方法</h4>

<ul>
<li>Shake对象设计</li>
</ul>

<table>
<thead>
<tr>
<th>属性</th>
<th align="center">值</th>
</tr>
</thead>

<tbody>
<tr>
<td>SHAKE_THRESHOLD</td>
<td align="center">阈值。阈值越大，触发摇晃事件时手机摇晃的程度越剧烈</td>
</tr>

<tr>
<td>x</td>
<td align="center">x方向的加速值</td>
</tr>

<tr>
<td>y</td>
<td align="center">y方向的加速值</td>
</tr>

<tr>
<td>z</td>
<td align="center">z方向的加速值</td>
</tr>

<tr>
<td>deviceMotionHandler</td>
<td align="center">摇晃事件处理程序</td>
</tr>
</tbody>
</table>

<table>
<thead>
<tr>
<th>方法</th>
<th align="center">作用</th>
</tr>
</thead>

<tbody>
<tr>
<td>init</td>
<td align="center">初始化Shake对象</td>
</tr>
</tbody>
</table>

<table>
<thead>
<tr>
<th>参数</th>
<th align="center">值</th>
</tr>
</thead>

<tbody>
<tr>
<td>threshold</td>
<td align="center">自定义阈值，默认2000</td>
</tr>

<tr>
<td>callback</td>
<td align="center">摇晃后的回调函数</td>
</tr>
</tbody>
</table>

<p><strong>示例</strong></p>

<pre><code>function Shake(threshold, callback) {
  this.SHAKE_THRESHOLD = threshold ? threshold : 2000; //定义阈值            
  this.last_update = 0;
  this.x = this.y = this.z = this.last_x = this.last_y = this.last_z = 0;
  this.init = function() {
      if (window.DeviceMotionEvent) { window.addEventListener('devicemotion', this.deviceMotionHandler, false); } else { alert('您的浏览器不支持DeviceMotion'); } };
  var that = this;
  this.deviceMotionHandler = function(eventData) {
      var acceleration = eventData.accelerationIncludingGravity;
      var curTime = new Date().getTime();
      if ((curTime - that.last_update) &gt; 100) {
          var diffTime = curTime - that.last_update;
          that.last_update = curTime;
          that.x = acceleration.x;
          that.y = acceleration.y;
          that.z = acceleration.z;
          var speed = Math.abs(that.x + that.y + that.z - that.last_x - that.last_y - that.last_z) / diffTime * 10000;
          if (speed &gt; that.SHAKE_THRESHOLD) {
              if (window.console &amp;&amp; console.log) { console.log(&quot;shaked&quot;); }
              if (callback != undefined) { callback(that); } }
          that.last_x = that.x;
          that.last_y = that.y;
          that.last_z = that.z; } }
};
</code></pre>

<p><strong>使用</strong></p>

<pre><code>&lt;!doctype html&gt;
&lt;head&gt;
    &lt;meta charset=&quot;utf-8&quot; /&gt;
    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no&quot; /&gt;
    &lt;title&gt;手机摇一摇测试&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;script&gt;
    window.onload = function() {
        var shake1 = new Shake(2000, function(obj) {
            alert(&quot;shaked&quot;);
            var r = document.getElementById(&quot;result&quot;);
            r.innerHTML = &quot;x:&quot; + obj.x　 + &quot;&quot;;
            r.innerHTML += &quot;y:&quot; + obj.y　 + &quot;&quot;;
            r.innerHTML += &quot;z:&quot; + obj.z　 + &quot;&quot;;
        });
        shake1.init();
    };
    &lt;/script&gt;
    &lt;div id=&quot;result&quot;&gt;&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>

<p>当手机摇晃页面时，会弹出shaked的提示，并且在页面上显示摇晃时的x,y,z方向的加速度值。
<strong>扩展应用</strong>
给Shake对象的callback参数可以实现不同的摇晃目的，如抽奖。需要在callback函数中调用抽奖系统的接口。</p>

<pre><code>//示例
function shakeCallback(){
    var odata = {name:&quot;drawprize&quot;,act_id : 0000};
    HBAPP.Activity.register(odata,function(json){
       if(json.error == 0){
           if(json.result.draw){
               //中奖信息
               //......
           }
       }
    });
}
</code></pre>

<h3 id="2-重力感应">2. 重力感应</h3>

<p>重力感应也是原生APP中经常见到的一个功能，在Web App中的应用多见于判断屏幕的旋转方向，以及在此基础上实现的场景应用，如控制页面上物体的左右移动，加减速等。</p>

<p>在Web App中实现以上的功能，需要实时获取屏幕的旋转方向参数，这些参数可以从浏览器的利用HTML5的DeviceOrientation API获得。</p>

<h4 id="接口说明">接口说明</h4>

<p>当浏览器的Orientation发生变化时，触发DeviceOrientation事件，并返回一个DeviceOrientationEvent对象，其属性列表如下：</p>

<blockquote>
<p>注：不同版本的手机操作系统和浏览器，以及不同的应用程序中内置的浏览器对deviceorientation事件的支持不尽相同。尤其在Android平台上，可能会出现有的设备正常工作，有的则毫无反应的情况。**</p>
</blockquote>

<h4 id="工作原理">工作原理</h4>

<p>根据event对象的三个方向的参数来确定设备的旋转角度。其中，alpha的取值范围是0-360,这个需要根据设备的指南针设定情况而定，一般来说，设备指向正北方向时为0.beta值为设备绕x轴旋转的角度，取值范围为-180-180。gamma取值范围-90-90.</p>

<p>这里面alpha值的意义并不大，主要参考beta和gamma值。
当屏幕从水平沿y轴向左倾斜时gamma值变为负值，向右倾斜变为正值。
档屏幕从水平沿x轴向前倾斜时beta值变为正值，向后倾斜时变为负值。
所以，如果我们设定一个阈值，当beta和gamma的绝对值大于这个阈值时，我们就认为设备发生了旋转。另外根据beta和gamma的值来判断向左倾斜还是向右倾斜，以及倾斜的程度。</p>

<h4 id="实现方式和示例">实现方式和示例</h4>

<p>首先是为浏览器绑定deviceorientation事件和处理程序。</p>

<pre><code>//add deviceorientation event listener
if(window.DeviceOrientationEvent){
    window.addEventListener('deviceorientation',DeviceOrientationHandler,false);
}else{
    alert(&quot;您的浏览器不支持DeviceOrientation&quot;);
}
</code></pre>

<p>然后在事件处理程序中处理相应的动作</p>

<pre><code>function DeviceOrientationHandler(event){
        var alpha = event.alpha,
            beta = event.beta,
            gamma = event.gamma;
 
        if(alpha != null || beta != null || gamma != null){
            dataContainerOrientation.innerHTML = &quot;alpha:&quot; + alpha + &quot;&lt;br /&gt;beta:&quot; + beta + &quot;&lt;br /&gt;gamma:&quot; + gamma;
            //判断屏幕方向
            var html = &quot;&quot;;
            if( Math.abs(gamma) &lt; GAMMA_MIN &amp;&amp; Math.abs(beta) &gt; BETA_MAX ){
                html = &quot;屏幕方向：Portrait&quot;;
            }
 
            if( Math.abs(beta) &lt; BETA_MIN &amp;&amp; Math.abs(gamma) &gt; GAMMA_MAX ){
                html = &quot;屏幕方向：Landscape&quot;;
            }
 
            var gamma_html = &quot;&quot;;
            if( gamma &gt; 0 ){
                gamma_html = &quot;向右倾斜&quot;;
            }else{
                gamma_html = &quot;向左倾斜&quot;;
            }
            html += &quot;&lt;br /&gt;&quot;+gamma_html
            stage.innerHTML = html;
        }else{
            dataContainerOrientation.innerHTML = &quot;当前浏览器不支持DeviceOrientation&quot;;
        }
}
</code></pre>

<p>这个示例中展示了如何利用beta和gamma值来展示屏幕的旋转方向和侧翻方向。要实现更精确的物体判断，还需要复杂的算法来计算。</p>

<h4 id="扩展应用">扩展应用</h4>

<p>使用DeviceOrientation API接口可以实现在web中获取手机设备的屏幕旋转方向参数，在示例的基础上进行改进，可以扩展到在屏幕上控制页面元素的移动，实现动画或游戏的目的。例如通过调整屏幕的方向控制页面上的小球走迷宫，控制小车的移动躲避障碍等。</p>

<h3 id="使用phaser和html5特性检测移动设备旋转重力方向">使用Phaser和HTML5特性检测移动设备旋转重力方向</h3>

<p>HTML5中包含一个帮助检测device orientation的特性，使用这个特性可以在移动设备浏览器中判断用户设备的旋转重力方向。</p>

<p>基本知识：Alpha, Beta, Gamma角度旋转</p>

<p>当用户旋转手机的时候，HTML5中定义了三个轴方向的旋转，如下：</p>

<p>上图可以看考，分别是z，x，y轴，对应分别是：Alpha，Beta，Gamma，下面图将更清楚的展示：</p>

<p><strong>1. Alpha</strong></p>

<p>上图是Alpha旋转，　围绕Z轴旋转（绿线旋转方向，水平）</p>

<p><strong>2. Beta</strong></p>

<p>上图是Beta旋转，　围绕X轴旋转（绿线旋转方向，前后）</p>

<p><strong>3. gamma</strong></p>

<p>上图是gamma旋转，　围绕Y轴旋转（绿线旋转方向，左右）</p>

<p>了解了基本几个方向的旋转，接下来介绍一下相关的方法：</p>

<p><code>window.addEventListener(“deviceorientation”, handleOrientation);</code>
在HTML5中使用以上事件监听设备方向变化。</p>

<pre><code>function handleOrientation(event) {
var absolute = event.absolute;
var alpha = event.alpha;
var beta = event.beta;
var gamma = event.gamma;
}
</code></pre>

<p>以上在定义的监听方法中通过event参数获取设备的对应Alpha, Beta和Gamma角度。参数定义如下：</p>

<pre><code>DeviceOrientationEvent.absolute
DeviceOrientationEvent.alpha
DeviceOrientationEvent.beta
DeviceOrientationEvent.gamma
</code></pre>

<p>其中相关值：</p>

<p>alpha : 0 到 360度</p>

<p>Beta : -180到180度</p>

<p>Gamma : -90到90度</p>

<p>接下来为了验证HTML5这个特性，我们使用Phaser来制作一个简答的小游戏:</p>

<p>首先是导入Phaser类库</p>

<p><code>&lt;script type=”text/javascript” src=”http://cdn.gbtags.com/phaser/2.0.6/phaser.min.js”&gt;&lt;/script&gt;</code>
然后定义HTML代码中游戏的容器元素：</p>

<p><code>&lt;div id=”gamezone”&gt;&lt;/div&gt;</code>
接下来使用Phaser的游戏类生成游戏：</p>

<pre><code>var game = new Phaser.Game(300,
400,
Phaser.CANVAS,
‘gamezone’,
{preload:preload , create:create ,update:update }
);
</code></pre>

<p>下面是具体方法：</p>

<pre><code>/* 定义预加载方法，图片，声音等等 */
function preload(){
game.load.image(‘imagemoveing’, ‘http://www.gbtags.com/gb/laitu/50×50&amp;text=图片移动/DDDDDD/DDDDDD’);
//了解如何使用来图工具，请移步至：http://www.gbtags.com/gb/gblaitu.htm
}
</code></pre>

<pre><code>/* 定义游戏创建方法 */
var dogsprite,betadirection=0,gammadirection=0;
function create(){
//这里添加图片并且居中显示到屏幕上
dogsprite = game.add.sprite(game.world.centerX, game.world.centerY , ‘imagemoveing’);
dogsprite.anchor.set(0.5);
//启动并添加物理效果
game.physics.startSystem(Phaser.Physics.ARCADE); //这里选择使用的物理系统,Phaser.Physics.ARCADE是缺省值
game.physics.arcade.enable(dogsprite);//保证dogsprite拥有物理特性
dogsprite.body.velocity.set(30);
}
function update(){
//移动游戏中的方块图片元素逻辑
}
</code></pre>

<p>最后执行设备方向检测，这里只检测x,y轴，你向某个方向偏移设备，则获取偏移量：</p>

<pre><code>function deviceOrientationListener(event) {
betadirection = Math.round(event.beta);
gammadirection = Math.round(event.gamma);
}
if (window.DeviceOrientationEvent) {
window.addEventListener(“deviceorientation”, deviceOrientationListener);
} else {
alert(“您使用的浏览器不支持Device Orientation特性”);
}
</code></pre>

<p>最后，在Phaser的update方法中，根据偏移量来计算移动速度和方向，如下：</p>

<pre><code>function update(){
var speed = 10*(Math.abs(betadirection)+Math.abs(gammadirection));
if(betadirection&lt;0&amp;&amp;gammadirection&lt;0){
game.physics.arcade.moveToXY(dogsprite, 0, 0, speed);
}else if(betadirection&lt;0&amp;&amp;gammadirection&gt;0){
game.physics.arcade.moveToXY(dogsprite, 300, 0, speed);
}else if(betadirection&gt;0&amp;&amp;gammadirection&gt;0){
game.physics.arcade.moveToXY(dogsprite, 300, 400, speed);
}else if(betadirection&gt;0&amp;&amp;gammadirection&lt;0){
game.physics.arcade.moveToXY(dogsprite, 0, 400, speed);
}else{
dogsprite.body.velocity.set(0);
}
}
</code></pre>

<p>以上使用最简单的逻辑，移动设别后，就向四个象限移动，并且你社区偏移量越大，速度越快。速度逻辑如下：</p>

<p><code>var speed = 10*(Math.abs(betadirection)+Math.abs(gammadirection));</code>
使用phaser的moveToXY方法执行移动：</p>

<p><code>game.physics.arcade.moveToXY(dogsprite, 300, 400, speed);</code>
注意：不同的设备及其浏览器的Alpha，Beta，Gamma可能设置不一样，你需要具体针对性实现代码。</p>

<p>** 本例在iphone上测试通过，如果需要使用浏览器测试，推荐使用chrome，并且启动“模拟器和重力选项”，如下：**</p>

<p>好了，小游戏已经基本搞定了，大家来试试吧。</p>

<h2 id="html5-orientation-方向接口应用">HTML5 orientation 方向接口应用</h2>

<blockquote>
<p>Note that &ldquo;orientationchange&rdquo; and screen.orientation are unprefixed in the following</p>

<p>监听orientationchange</p>

<pre><code>window.addEventListener(&quot;orientationchange&quot;, function() {
    alert(&quot;the orientation of the device is now &quot; + screen.orientation.angle);
});
</code></pre>
</blockquote>

<pre><code>    //判断横屏竖屏
function checkDirection() {
    if (document.documentElement.clientHeight &gt;= document.documentElement.clientWidth) {
        return &quot;portrait&quot;;
    } else {
        return &quot;landscape&quot;;
    }
}

function orientNotice() {
    var orientLayer = document.getElementById(&quot;orientLayer&quot;);
    var orient = checkDirection();
    if (orient == &quot;portrait&quot;) {
        orientLayer.style.display = &quot;none&quot;;
    } else {
        orientLayer.style.display = &quot;block&quot;;
    }
}

function initOrientState() {
    var strVar = &quot;&quot;;
    strVar += &quot;&lt;!--下面是竖屏提示,性能原因丢最后--&gt;\n&quot;;
    strVar += &quot;\n&quot;;
    strVar += &quot;&lt;div id=\&quot;orientLayer\&quot; class=\&quot;mod-orient-layer\&quot;&gt;\n&quot;;
    strVar += &quot;    &lt;div class=\&quot;mod-orient-layer__content\&quot;&gt;\n&quot;;
    strVar += &quot;        &lt;i class=\&quot;icon mod-orient-layer__icon-orient\&quot;&gt;&lt;\/i&gt;\n&quot;;
    strVar += &quot;\n&quot;;
    strVar += &quot;        &lt;div class=\&quot;mod-orient-layer__desc\&quot;&gt;为了更好的体验，请使用竖屏浏览&lt;\/div&gt;\n&quot;;
    strVar += &quot;    &lt;\/div&gt;\n&quot;;
    strVar += &quot;&lt;\/div&gt;\n&quot;;
    $(&quot;body&quot;).append(strVar);
    orientNotice();
    
    window.addEventListener(&quot;onorientationchange&quot; in window ? &quot;orientationchange&quot; : &quot;resize&quot;, function () {
        // if (window.orientation === 90 || window.orientation === -90) {
        //     console.log('cross')
        // } else {
        //     console.log('vertical')
        // }
        setTimeout(orientNotice, 200);
    })
}
</code></pre>

<pre><code>/* screen orient 屏幕方向*/
@keyframes rotation { 
  10% { 
  transform: rotate(90deg); 
  -webkit-transform: rotate(90deg);
  -webkit-transform: rotate(90deg) 
  } 
  50% { 
  transform: rotate(0); 
  -webkit-transform: rotate(0);
  -ms-transform: rotate(0) 
  } 
  60% { 
  transform: rotate(0); 
  -webkit-transform: rotate(0);
  -ms-transform: rotate(0)  
  } 
  90% { 
  transform: rotate(90deg); 
  -webkit-transform: rotate(90deg);
  -ms-transform: rotate(90deg)  
  } 
  100% { 
  transform: rotate(90deg); 
  -webkit-transform: rotate(90deg);
  -ms-transform: rotate(90deg)  
  } 
  }


  .mod-orient-layer {
    display: none;
    position: fixed;
    height: 100%;
    width: 100%;
    left: 0;
    top: 0;
    right: 0;
    bottom: 0;
    background: #000;
    z-index: 9997
}

.mod-orient-layer__content {
    position: absolute;
    width: 100%;
    top: 45%;
    margin-top: -75px;
    text-align: center
}

.mod-orient-layer__icon-orient {
    display: inline-block;
    width: 67px;
    height: 109px;
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIYAAADaCAMAAABU68ovAAAAXVBMVEUAAAD29vb////x8fH////////x8fH5+fn29vby8vL////5+fn39/f6+vr////x8fH////////+/v7////09PT////x8fH39/f////////////////////x8fH///+WLTLGAAAAHXRSTlMAIpML+gb4ZhHWn1c2gvHBvq1uKJcC6k8b187lQ9yhhboAAAQYSURBVHja7d3blpowFIDhTUIAOchZDkre/zE7ycySrbUUpsRN2/1fzO18KzEqxEVgTiZNfgmmtxRc8iaR8HNe8x4BtjQePKayYCIoyBSgvNNE1AkNSHqZyLqk97EgUCCHBzZ5mkg7ScvIJuIyOyXBRFxgpqWZyGsAZLB1KjsJi8nutHU4JCRbFRH8tmirI9k8Jx2sqNs8K/m0LQkrktO2crgcgXGB4AiTEsB0hJfo9MGgX7CGcYiYwQxmMOOvZwRhBG8tCoMXjBDeXvWCEcHbi14wgCBmMIMZzGAGM5jxETNwzMAxA8cMHDNwzMAxA8cMHDNwzMAxA8cMHDNwzMAxY6E2rUQxnH2tz9cirlJFwFBJedaPnUv0M7++egPDE8iAJcIDmxwH5wwv9vUviw2kLbVO3TJU5uul/EyB0FoLp4x60PdGUd3qPurrWyjGGTc05u+1dcgI7/+tCCPARWGhH7o5Y7RCf+bH9ctXLp6v2BVDxfqz0oPXeSVaNtINo/1SXDv4dck8IIkbhtC2ol+iouEonTBCbYvVMnXOjxww6s/RFrBUpXHh/gw1rHj5d/qhYn9Gpk2FWh6xRBRX5Oj3Znh2Sq49/L6+y8pB26q9GbE2dbA2mVbx6I+7MfBglLCttm73ZQi7AD3iL4HqjFYJHSPRppqaUaJ3ATpGa+ckpGak2hRRMyqjGMkvl+xyFeSMwjAqcsZgGDdyhl0oNTnDN4yenJGZFGxNChP5/Y3efh6SM2rDOJMzboYxkDMqwyjIGcIw6F+io2FU1IxIm1JqRmgXSkvNKNCXeTpGrU0JNSO2c6LIGPgCS8AuDHz9ta0SXWDtxoDRH+MqlbC2Dt2G2JFRadtQZt2qq/orGowdGb2euxYiqWEpVWhTBnszoNAPdStuQwxqf0aocdWKW4Z+DfszIh8pxJqbuCE4YAC+4bm0evtipjpgJHeFnyyt1Ku2xa0bhjxr27p75rECNwyI9ZwvXkHq+7aTaMEV44YYy/spfgjgjNHaWW+GeUhGEX7tLlVinIFDDSgnOwhi1V6bU0b6tVS9eAERe863g4dRrtiHdc6o+nn5vtyVVgR79Cqt4uL6gfHPQyGqtP2vf7HADGbcYwaOGThm4JiBYwaOGThm4JiBYwaOGThm4JiBYwaOGThm4JiBYwaOGThm4JjhtOM+J/AgT008yDMkN/dPP9hzS8zAMQN3OEYeekp5YU7KOKXwVXqiY+QS7smcinGKABWdiBgpPJTSMHJ4KidhhPBUSMLw4CmPhKHgKUXCkHsygum71ftNSgCX6bsl8FQyfbcL5EdYsDk0R3j7aiA5wpt5AjKg/2gLJEBD/0Hf2OOf/vRrj6z/7GtP4B3nMKyjHA12kIPSjnJs3FEO0TvKkYJHOWCR+rjJH0Vn6fI5PjNbAAAAAElFTkSuQmCC');
    transform: rotate(90deg);
    -webkit-transform: rotate(90deg);
    -webkit-animation: rotation infinite 1.5s ease-in-out;
    animation: rotation infinite 1.5s ease-in-out;
    -webkit-background-size: 67px;
    background-size: 67px
}

.mod-orient-layer__desc {
    margin-top: 20px;
    font-size: 15px;
    color: #fff
}

.mod-orient-layer__desc {
    margin-top: 20px;
    font-size: 15px;
    color: #fff
}
</code></pre>

<h2 id="html5-地理定位-geolocation">HTML5 - 地理定位 Geolocation</h2>

<pre><code>navigator.geolocation.getCurrentPosition(function(position){

console.log(position.coords.latitute,position.coords.longtitude)

})
</code></pre>

<h3 id="完美解决window-navigator-geolocation-getcurrentposition-在ios10系统中无法定位问题">完美解决window.navigator.geolocation.getCurrentPosition，在IOS10系统中无法定位问题</h3>

<p>1、将网站的http设置为Https。</p>

<p>2、通过第三方解决，这也是我目前使用的方法。 //如使用百度定位</p>

<pre><code>  &lt;script src=&quot;/Content/Scripts/jquery.flexslider.js&quot;&gt;&lt;/script&gt;  
&lt;script type=&quot;text/javascript&quot; src=&quot;http://api.map.baidu.com/api?v=2.0&amp;ak=6yAoynmTPNlTBa8z1X4LfwGE&quot;&gt;&lt;/script&gt;  
&lt;script type=&quot;text/javascript&quot; src=&quot;http://developer.baidu.com/map/jsdemo/demo/convertor.js&quot;&gt;&lt;/script&gt;
</code></pre>

<h2 id="html5的popstate如何玩转浏览器历史记录">HTML5的popstate如何玩转浏览器历史记录</h2>

<p>一、popstate用来做什么的？
简而言之就是HTML5新增的用来控制浏览器历史记录的api。</p>

<p>二、过去如何操纵浏览器历史记录？
window.history对象，该对象上包含有length和state的两个值，在它的<strong>proto</strong>上继承有back、forward、go等几个功能函数
在popstate之前，我们可以利用back、forward、go对history进行后退和前进操作。
例如：
history.back(); (后退一步，使用history.go(-1)也可实现后退效果)
弊端：只能操作前进后退，但是无法控制前进后要去哪，history.length都只会维持原来的状态</p>

<p>三、popstate的怎么用？
HTML5的新API扩展了window.history，使历史记录点更加开放了。可以存储当前历史记录点pushState、替换当前历史记录点replaceState、监听历史记录点popstate。</p>

<p>pushState、replaceState两者用法差不多。</p>

<p>使用方法：</p>

<p>history.pushState(data,title,url);
//其中第一个参数data是给state的值；第二个参数title为页面的标题，但当前所有浏览器都忽略这个参数，传个空字符串就好；第三个参数url是你想要去的链接；
replaceState用法类似，例如：history.replaceState(&ldquo;首页&rdquo;,&ldquo;&rdquo;,location.href+ &ldquo;#news&rdquo;);</p>

<pre><code>一、简单介绍 history 中的操作

1.window.history.back()，后退

2.window.history.forward()，前进

3.window.history.go(num)，前进或后退指定数量历史记录

4.window.history.pushState(state, title, utl)，在页面中创建一个 history 实体。直接添加到历史记录中。

　　参数：  state：存储一个对象，可以添加相关信息，可以使用 history.state 读取其中的内容。

　　　      title：历史记录的标题。

　　　      url：创建的历史记录的链接。进行历史记录操作时会跳转到该链接。

5.window.history.replaceState()，修改当前的 history 实体。

6.popstate 事件，history 实体改变时触发的事件。

7.window.history.state，会获得 history 实体中的 state 对象。
</code></pre>

<p><em>注意事项</em></p>

<blockquote>
<p>两者区别：pushState会改变history.length，而replaceState不改变history.length</p>

<p>1.每次返回都会消耗一个 history 实体，若用户选择取消离开，则需要继续 pushState 一个实体</p>

<p>2.pushState 只能一个实体，多个实体返回会出错。使用 window.history.state 查询是否存在添加的实体。</p>
</blockquote>

<pre><code>&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head lang=&quot;en&quot;&gt;
    &lt;meta charset=&quot;UTF-8&quot;&gt;
    &lt;title&gt;图解用HTML5的popstate如何玩转浏览器历史记录&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;


&lt;span class=&quot;js-news&quot;&gt;新闻&lt;/span&gt;
&lt;span class=&quot;js-music&quot;&gt;音乐&lt;/span&gt;
&lt;script&gt;

    var locationHref = location.href;
    document.addEventListener(&quot;click&quot;, function (event) {
        var target = event.target;
        if (target.className == &quot;js-news&quot;) {
            history.pushState(&quot;首页&quot;, &quot;&quot;, locationHref + &quot;#news&quot;);
        } else if (target.className == &quot;js-music&quot;) {
            history.pushState(&quot;音乐&quot;, &quot;&quot;, locationHref + &quot;#music&quot;);
        }
    });

    /*    document.addEventListener(&quot;click&quot;,function(event){
     var target = event.target;
     if(target.className == &quot;js-news&quot;){
     history.replaceState(&quot;首页&quot;,&quot;&quot;,locationHref + &quot;#news&quot;);
     }else if(target.className == &quot;js-music&quot;){
     history.replaceState(&quot;音乐&quot;,&quot;&quot;,locationHref + &quot;#music&quot;);
     }
     });*/
    
    window.addEventListener(&quot;popstate&quot;, function () {
        console.log(history.state);
    })
&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>

<pre><code>//例如modal页操作，为了实现后退效果，可以pushState;
//1  当前页面ajax局部刷新，或者打开modal页；插入一条page记录
history.pushState(&quot;null&quot;,'',location.href.split(&quot;#&quot;)[0]+'#detail');

//2 监听页面回退或前进,达到路径跳转效果
    window.addEventListener(&quot;popstate&quot;, function() {
        var currentState = history.state;
        location.reload();
    });
      
</code></pre>

<h2 id="html5-workers-后台运行js">Html5 workers 后台运行js</h2>

<p>HTML5 Web Workers是为网页脚本提供了一种能在后台进程中运行的方法。当创建WoOer对象后，WebwbrkerS就可以通过postMessage方法向任务池发送任务请求，执行完之后再通过postMessage返回消息给创建者指定的事件处理程序，然后通过onmessage捕获返回消息，实现前后台数据的交互。</p>

<p>Web Workers应用场景</p>

<p>在Web应用程序中，Web WoOers是一项后台处理技术。在此之前使用JavaScript创建的W曲程序中，因为所有的处理都是在单线程内执行，所以如果脚本所需运行时间太长，程序界面会长时间处于停止响应状态，甚至当等待时间超出一定的限度，浏览器会提示脚本运行时间过长需要中断正在执行的处理。</p>

<p>为了解决这个问题，HTML5新增了一个Web WorkersAPI。使用这个API，用户可以很容易地创建在后台运行的线程，这个线程被称为Worker，如果将可能耗费较长时间的处理交给后台执行，则对用户在前台页面中执行的操作没有影响。</p>

<p>尽管Web Workers功能强大，但也不是万能的，例如，在Web Workers中执行的脚本不能访问该页面的window对象，因此Web Workers不能直接访问Web页面和DOM API，虽然Web Workers不会导致浏览器UI停止响应，但是仍然会消耗CPU周期，导致系统反应速度变慢。</p>

<p>如果开发人员创建的Web应用程序需要执行一些后台数据处理，但又不希望这些数据处理任务影响Web页面本身的交互性，那么可以通过Web Workers生成一个WoOer去执行数据处理任务。同时添加一个事件监听器进行监听，并与之进行数据交互。</p>

<p>Web Workers的另一个用途是可以监听由后台服务器广播的消息，收到后台服务器的消息后，将其显示在Web页面上。这种与后台服务器对话的场景，Web Workers可能会使用到Web Sockets或Server—Sent事件。</p>

<p>Web Workers接口可以创建真正的系统级别的进程，还可以使用XMLHttpRequest来处理I／O，无论responseXML和channel属性是否为null。使用它可以很容易设计并发操作效果，这将会很有趣。例如，在做网站下载的时候使用Worker，或者使用Worker实现处理扩展功能。</p>

<p>注意：后台进程（包括Web Workers进程）不能对DOM进行操作。如果希望后台程序处理的结果能够改变DOM，只能通过返回消息给创建者的回调函数进行处理。</p>

<p>Web Workers能够为用户做些什么？</p>

<p>加载一个JavaScript文件，进行大量的复杂计算，而不挂起主进程，并通过postMessage和onMessage进行通信。</p>

<p>可以在WoOer中通过importScripts（url）方法加载JavaScript脚本文件。</p>

<p>可以使用setTimeout（）、clearTimeout（）、setInterval（）和clearInterval（）。</p>

<p>可以使用XMLHttpRequest进行异步请求。</p>

<p>可以访问navigator的部分属性。</p>

<p>可以使用JavaScript核心对象。</p>

<p>web Workers的局限性：</p>

<p>不能跨域加载JavaScriot。</p>

<h2 id="前端项目优化">前端项目优化</h2>

<p>前端是庞大的，包括 HTML、 CSS、 Javascript、Image 、Flash等等各种各样的资源。前端优化是复杂的，针对方方面面的资源都有不同的方式。那么，前端优化的目的是什么 ?　　</p>

<ol>
<li><p>从用户角度而言，优化能够让页面加载得更快、对用户的操作响应得更及时，能够给用户提供更为友好的体验。　</p></li>

<li><p>从服务商角度而言，优化能够减少页面请求数、或者减小请求所占带宽，能够节省可观的资源。　　</p></li>
</ol>

<p>总之，恰当的优化不仅能够改善站点的用户体验并且能够节省相当的资源利用。　　</p>

<p>前端优化的途径有很多，按粒度大致可以分为两类，</p>

<p>第一类是页面级别的优化，例如 HTTP请求数、脚本的无阻塞加载、内联脚本的位置优化等;</p>

<p>第二类则是代码级别的优化，例如 Javascript中的DOM操作优化、CSS选择符优化、图片优化以及HTML结构优化等等。另外，本着提高投入产出比的目的，后文提到的各种优化策略大致按照投入产出比从大到小的顺序排列。</p>

<h3 id="一页面级优化">一页面级优化</h3>

<blockquote>
<ol>
<li>减少 HTTP请求数</li>
</ol>
</blockquote>

<pre><code>(1). 从设计实现层面简化页面
(2). 合理设置 HTTP缓存 (HTTP Header中的Expires设置一个很长的过期头 ;变化不频繁而又可能会变的资源可以使用 Last-Modifed来做请求验证。尽可能的让资源能够在缓存中待得更久。)
(3). 资源合并与压缩
(4). CSS Sprites
(5). Inline Images
(6). Lazy Load Images
</code></pre>

<blockquote>
<ol>
<li><p>将外部脚本置底（将脚本内容在页面信息内容加载后再加载）</p></li>

<li><p>异步执行 inline脚本(其实原理和上面是一样，保证脚本在页面内容后面加载。)</p></li>

<li><p>Lazy Load Javascript</p></li>

<li><p>将 CSS放在 HEAD中</p></li>

<li><p>异步请求 Callback（就是将一些行为样式提取出来，慢慢的加载信息的内容）</p></li>

<li><p>减少不必要的 HTTP跳转</p></li>

<li><p>避免重复的资源请求</p></li>
</ol>
</blockquote>

<h3 id="二-代码级优化">二、代码级优化</h3>

<blockquote>
<ol>
<li>Javascript</li>
</ol>
</blockquote>

<pre><code>(1).DOM
    DOM操作应该是脚本中最耗性能的一类操作，例如增加、修改、删除 DOM元素或者对 DOM集合进行操作。如果脚本中包含了大量的 DOM操作则需要注意以下几点：
        a. HTML Collection（HTML收集器，返回的是一个数组内容信息）; 在脚本中 document.images、document.forms 、getElementsByTagName()返回的都是 HTMLCollection类型的集合
        b. Reflow &amp; Repaint (除了上面一点之外， DOM操作还需要考虑浏览器的 Reflow和Repaint)
(2). 慎用 with
(3). 避免使用 eval和 Function
    eval 函数效率特别低，由于事先无法知晓传给 eval 的字符串中的内容
(4). 减少作用域链查找（这方面设计到一些内容的相关问题）
    前文谈到了作用域链查找问题，这一点在循环中是尤其需要注意的问题。如果在循环中需要访问非本作用域下的变量时请在遍历之前用局部变量缓存该变量，并在遍历结束后再重写那个变量，这一点对全局变量尤其重要，因为全局变量处于作用域链的最顶端，访问时的查找次数是最多的。
    ```
    /*低效率写法*/

    // 全局变量 
    var globalVar = 1; 
    function myCallback(info){ 
        for( var i = 100000; i--;){ 
        //每次访问 globalVar 都需要查找到作用域链最顶端，本例中需要访问 100000 次 
        globalVar += i; 
        }
    } 

    ```
    ```
    /*更高效写法*/
            // 全局变量 
    var globalVar = 1; 
    function myCallback(info){ 
    //局部变量缓存全局变量 
        var localVar = globalVar; 
        for( var i = 100000; i--;){ 
        //访问局部变量是最快的 
            localVar += i; 
         } 
        //本例中只需要访问 2次全局变量
        在函数中只需要将 globalVar中内容的值赋给localVar 中区
        globalVar = localVar; 
    }
    　　此外，要减少作用域链查找还应该减少闭包的使用。
    ```
(5). 数据访问
    Javascript中的数据访问包括直接量 (字符串、正则表达式 )、变量、对象属性以及数组，其中对直接量和局部变量的访问是最快的，对对象属性以及数组的访问需要更大的开销。

(6). 字符串拼接
</code></pre>

<blockquote>
<p>2.CSS选择符 (浏览器对选择符的解析是从右往左进行的)
3.HTML
4.图片压缩</p>
</blockquote>

<h3 id="dom结构-timeline-repaint-重绘-与reflow-回流">DOM结构 timeline repaint(重绘)与reflow(回流)</h3>

<blockquote>
<p>reflow:当render树中的一部分或者全部因为大小边距等问题发生改变而需要重建的过程叫做回流.</p>

<p>repaint:当元素的一部分属性发生变化，如外观背景色不会引起布局变化而需要重新渲染的过程叫做重绘。</p>
</blockquote>

<p>relow 一定会引起 repaint，repaint不一定引起reflow;</p>

<p>参考：<a href="https://www.cnblogs.com/dujingjie/p/5784890.html">回流（reflow）与重绘（repaint）</a></p>

<blockquote>
<p>如何避免？
但是尽管浏览器挺机智地帮我们优化了代码，我们自己作死也是没救的，比如你去请求</p>
</blockquote>

<ol>
<li><p>offsetTop, offsetLeft, offsetWidth, offsetHeight</p></li>

<li><p>scrollTop/Left/Width/Height</p></li>

<li><p>clientTop/Left/Width/Height</p></li>

<li><p>width,height</p></li>

<li><p>请求了getComputedStyle(), 或者 IE的 currentStyle</p></li>
</ol>

<p>浏览器为了给你返回一个比较精确的答案，他会提前flush队列，因为队列中可能会有影响这些值的操作。</p>

<p>所以我们可以做的是：</p>

<p>1.将那些改变样式的操作集合在一次完事，直接改变className或者cssText</p>

<p>2.让要操作的元素进行离线处理，处理完事以后再一起更新</p>

<p>（1）使用DocumentFragment进行缓存操作，引发一次回流和重绘</p>

<p>课外延伸：</p>

<p>DocumentFragment 节点不属于文档树，继承的 parentNode 属性总是 null。</p>

<p>不过它有一种特殊的行为，该行为使得它非常有用，即当请求把一个 DocumentFragment 节点插入文档树时，插入的不是 DocumentFragment 自身，而是它的所有子孙节点。这使得 DocumentFragment 成了有用的占位符，暂时存放那些一次插入文档的节点。它还有利于实现文档的剪切、复制和粘贴操作。</p>

<p>其实他就是一个游离在DOM树外面的容器，所以你在把它插入文档节点之前，随便给他增删节点都不会引起回流</p>

<p>（2）使用display:none,只引发两次回流和重绘。道理跟上面的一样。因为display:none的元素不会出现在render树</p>

<p>（3）使用cloneNode和replaceChild技术，引发一次回流和重绘（这条其实没太明白）</p>

<p>3.不要经常访问会引起浏览器flush队列的属性，非要高频访问的话建议缓存到变量；</p>

<p>4.将需要多次重排的元素，position属性设为absolute或fixed，这样此元素就脱离了文档流，它的变化不会影响到其他元素。例如有动画效果的元素就最好设置为绝对定位；</p>

<p>5.尽量不要使用表格布局，如果没有定宽表格一列的宽度由最宽的一列决定，那么很可能在最后一行的宽度超出之前的列宽，引起整体回流造成table可能需要多次计算才能确定好其在渲染树中节点的属性，通常要花3倍于同等元素的时间。</p>

                </article>

              </div>
              
              <div class="card-action card-action-links">
                
                <a class="btn btn-secondary" href="https://www.wuxingtao.club/tags/summary">Summary</a> 
                <a class="btn btn-secondary" href="https://www.wuxingtao.club/tags/html">html</a> 
              </div>
              
              <div class="card-action">
                
              </div>

              
              <div class="pagination-single">
                 
                <span class="pagination-item previous">
                  <i class="material-icons">navigate_before</i>
                  <a href="https://www.wuxingtao.club/posts/summary-regexp-learn/" rel="prev">【正则-个人整理】</a>
                </span>  
                
                
                <span class="pagination-item next">
                  <a href="https://www.wuxingtao.club/posts/summary-git-learn/" rel="next">GIT【个人整理】</a>
                  <i class="material-icons">navigate_next</i>
                </span> 
              </div>
              

            </div>
          </div>
        </section>
      </div>
    </div>
  </div>
  <footer class="page-footer">
  <div class="container">
    <div class="inner">
      <div class="wrapper">
        <div class="group group-slink">
          <h5>wuxingtao Blog</h5>
          
            
            
          <ul class='slink'>
             
            <li>
              <a href="https://github.com/wuxingtao" target="_blank" title="Github">
                <svg class='svg-icons svg-icons-github'><use xlink:href='#svg-icons-github'></use></svg>
              </a>
            </li>
            
            <li>
              <a href="https://twitter.com/wuxingtao" target="_blank" title="Twitter">
                <svg class='svg-icons svg-icons-twitter'><use xlink:href='#svg-icons-twitter'></use></svg>
              </a>
            </li>
             
          </ul>
        </div>
        <div class="group group-flink">
          <h5>My Friends</h5>
          <ul>
            
          </ul>
        </div>
      </div>
    </div>
  </div>
  <div class="footer-copyright">
    <div class="container">
      <div class="inner">Copyleft@wuxingtao</div>
    </div>
  </div>
</footer>

</main>

<script type="text/javascript" async src="//cdn.bootcss.com/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_CHTML"></script>
<script type="text/javascript" src="//cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>

<script src="https://cdn.bootcss.com/highlight.js/9.12.0/languages/go.min.js"></script>
<script src="https://cdn.bootcss.com/highlight.js/9.12.0/languages/typescript.min.js"></script>
<script>
  hljs.configure({
    tabReplace: '  '
  })
  hljs.registerLanguage("graphql", function (e) { return { aliases: ["gql"], k: { keyword: "query mutation subscription|10 type interface union scalar fragment|10 enum on ...", literal: "true false null" }, c: [e.HCM, e.QSM, e.NM, { cN: "type", b: "[^\\w][A-Z][a-z]", e: "\\W", eE: !0 }, { cN: "literal", b: "[^\\w][A-Z][A-Z]", e: "\\W", eE: !0 }, { cN: "variable", b: "\\$", e: "\\W", eE: !0 }, { cN: "keyword", b: "[.]{2}", e: "\\." }, { cN: "meta", b: "@", e: "\\W", eE: !0 }], i: /([;<']|BEGIN)/ } });
  hljs.initHighlightingOnLoad();
  
</script>


<script type="text/javascript" src="https://www.wuxingtao.club/js/polyfill.js"></script>
<script type="text/javascript" src="https://www.wuxingtao.club/js/index.js"></script>



</body>

</html>